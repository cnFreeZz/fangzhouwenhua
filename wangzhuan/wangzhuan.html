<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/layor.css">
    <link rel="stylesheet" href="./css/style.css">
    <script type="text/javascript" src="./js/layer.js"></script>

    <title>Document</title>
    <script>
        var arr = ['123456'];
        var i = Math.floor(Math.random());
        var wechat = arr[i];
    </script>
</head>
<body>
    <div class="content">
        <div class="main-img">
            <img src="./images/微信图片_20181114152916.jpg" alt="#">
            <img src="./images/微信图片_20181114152903.jpg" alt="#">
            <img src="./images/微信图片_20181114152907.jpg" alt="#">
        </div>
        <!-- <div class="bottom-btn">
            <span>
                
            </span>
            <a href="weixin://" class="">
                <span class=""></span>
            </a>
        </div> -->
    </div>
    <div class="foot">
            <div class="bgs">
                <div class="pic"><img src="./images/n1.jpg" alt=""></div>
                <div class="tel">
                    微信号：<span class="url_id_x">123456</span>
                </div>
                <div class="btn">
                    <a class="copy weChat">复制微信</a>
                </div>
            </div>
    </div>
      <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
      <script>
            function remReSize() {
                var w = $(window).width();
                try {
                    w = $(parent.window).width();
                } catch (ex) {
        
                }
                if (w > 600) {
                    w = 600;
                }
                $('html').css('font-size', 100 / 600 * w + 'px');
            }
            remReSize();
            $(window).resize(remReSize);
            $(document).ready(function () {
                remReSize();
            });
            for (var i = 0; i < 3; i++) {
                setTimeout(remReSize, 100 * i);
            }
        
            // 获取URL后的参数
            function getUrlParams(param)
            {
                var query = location.search.substring(1);
                var arr = query.split("&");
                for (var i = 0; i < arr.length; i ++) {
                    var pair = arr[i].split('=');
                    if(pair[0] == param){return pair[1];}
                }
                return '123456';
            }
        
            // 获取URL 后面WX的部分 微信号
            var urlWx = getUrlParams('wx');
            $('.url_id_x').val(urlWx);
            $('.url_id_x').html(urlWx);
        
            var urlJg = getUrlParams('jg');
            if(urlJg == 360){
                var htmlPic = "<img src='static/picture/pic_r3_c1_s1_1.jpg'>";
                $('.li03').html(htmlPic);
            }else if(urlJg == 560) {
                var htmlPic = "<img src='static/picture/pic_r3_c1_s1_2.jpg'>";
                $('.li03').html(htmlPic);
            } else {
                var htmlPic = "<img src='static/picture/pic_r3_c1_s1.jpg'>";
                $('.li03').html(htmlPic);
            }
            console.log(urlJg);
        
            function UrlSearch() {
                var name, value;
                var str = location.href;   //获取到整个地址
                var num = str.indexOf("?");
                str = str.substr(num + 1);   //取得num+1后所有参数，这里的num+1是下标 str.substr(start [, length ]
                var arr = str.split("&"); //以&分割各个参数放到数组里
                for (var i = 0; i < arr.length; i++) {
                    num = arr[i].indexOf("=");
                    if (num > 0) {
                        name = arr[i].substring(0, num);
                        value = arr[i].substr(num + 1);
                        this[name] = value;
                    }
                }
                return value;
            }
        
            var titHtml = '<div class="title">' +
                '<h2>【火爆】中秋国庆双节贺礼 ，朋友圈都传疯了！</h2>' +
                '</div>';
        
            var idValue = UrlSearch();
        
            if(true|| idValue == 0 || idValue == null){
                $('#topTitle').html('');
            } else {
                $('#topTitle').html(titHtml);
            }
             $('#topTitle').html(titHtml);
        
            var xhtml = '<div class="layerbox"><p class="ti">复制成功</p><p class="nr">您已成功复制微信号，是否立即打开微信去搜索添加微信号？</p></div>';
        
            $('.weChat').on('click', function () {
                var txt = $('.url_id_x').val();
                copyWechatNum(txt);
                layer.open({
                    type: 0,
                    title: false,
                    shade: 0.6,
                    content: xhtml,
                    btn: ['确定', '取消'],
                    scrollbar: false ,
                    yes: function(index){
                        openwechatApp('weixin://');
                        layer.close(index);
                    },
                    btn2: function(index){
                        layer.close(index);
                    }
                })
            });
        
            // 复制微信号码
            function copyWechatNum(txt) {
                var input = document.createElement('input');
                input.value = txt;
                document.body.appendChild(input);
                input.select();
                input.setSelectionRange(0, input.value.length),
                    document.execCommand('Copy');
                document.body.removeChild(input);
            }
        
            // 点击链接 判断是否有微信 有则打开 没有则提示下载
            function openwechatApp(url) {
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    location.href = url;
                } else {
                    var timeout, t = 1000, hasApp = true;
                    var ua = navigator.userAgent.toLowerCase();
                    var isWechat = ua.indexOf('micromessenger') != -1;
                    setTimeout(function () {
                        if (!hasApp && !isWechat) {
                            // 没有安装微信并且不是在微信浏览器打开
                            layer.open({
                                type: 0,
                                content: '您未安装微信，请先安装微信!',
                                btn: ['确定', '取消'],
                                yes: function (index) {
                                    location.href = url;
                                    layer.close(index);
                                },
                                btn2: function (index) {
                                    layer.close(index);
                                }
                            });
                        } else if(isWechat){
                            layer.open({
                                type: 0,
                                content: '您已经在微信端打开，返回微信黏贴搜索微信号！',
                                btn: ['我知道了'],
                                yes: function (index) {  
                                    layer.close(index);
                                }
                            });
                        } else {
        
                        }
                        document.body.removeChild(ifr);
                    }, 2000);
                    var t1 = Date.now();
                    var ifr = document.createElement("iframe");
                    ifr.setAttribute('src', url);
                    ifr.setAttribute('style', 'display:none');
                    document.body.appendChild(ifr);
                    timeout = setTimeout(function () {
                        var t2 = Date.now();
                        if (!t1 || t2 - t1 < t + 100) {
                            hasApp = false;
                        }
                    }, t);
                }
            }
        </script>
</body>
</html>